<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="page2_stylesheet_Cecilia_Versjon4.css">
  <title>Page of lists</title>
</head>

<body>

  <div class="grid-container">
    <div id="taskPlannerMenu">
      <button id="signOutButton">Sign out</button>
      <button id="deleteUserButton">Delete user</button>
    </div>
    <div id="taskPlannerHeader_page2">
      <p id="headerTitle">MantisClam Taskplanner</p>
    </div>
    <div id="createNewList">
      <input id="titleOfListInput" placeholder="Title of new list..." maxlength="20">
      <button id="addNewListButton">Add new list</button>
    </div>

    <div class="allLists">
      <p>Hyttetur</p>
      <button class="deleteListButton">Delete</button>
      <button id="updateListButton" class="updateListButton">Update</button>
    </div>



  </div>

</body>

<script>

        let titleOfListInput = document.getElementById('titleOfListInput');

        //henter fra sessionstorage
        let jsontext = sessionStorage.getItem("userData");
        let userData = JSON.parse(jsontext);
        console.log(userData);
        let credentials = null;

        //"hindrer" forbipassering av login (aka skrive inn url selv)
        if(!userData) {
          location.href = "index.html"
        }

        //legg til
        document.getElementById("addNewListButton").onclick = function (evt) {

            //list items -------------------------------------------------------------------------------------------------------
            let listTitle = titleOfListInput.value; //her bestemmes hva som blir lagt inn som title
            console.log(listTitle);
            
            let body = {
                listTitle: listTitle,
                userid: userData.userid
            }
            let config = {
                method: "POST",
                headers: {
                    "content-type": "application/json",
                    "authorization": credentials
                },
                body: JSON.stringify(body)
            }

            fetch("/list", config).then(resp => {
                console.log(resp.status);
            })
        }

        //hent ned
        document.getElementById("updateListButton").onclick = async function (evt) {
            try {

            let userid = userData.userid;

            let config = {
                method: "GET",
                headers: {
                    "content-type": "application/json",
                    "authorization": credentials
                }
            }

                let response = await fetch(`/list/${userid}`, config)
                console.log(response.status);
                let data = await response.json();
                console.log(data);

                let jsontext = JSON.stringify(data);
                sessionStorage.setItem("listData", jsontext);

                location.href = "page3_Cecilia_Versjon1_Nora1.html"
            
            } catch (error) {
                console.error(error)
            }
        }

        //---------------------------------------------------------------------------------------------------------------------------------

        //sign out------------------------------------------------------------------------------------------------------------
        document.getElementById("signOutButton").onclick = function (evt) {
          
            sessionStorage.removeItem("userData");
            sessionStorage.removeItem("listData");
            sessionStorage.removeItem("itemData");

            location.href = "index.html";
        }
        //-------------------------------------------------------------------------------------------------------------

        //Delete user
        document.getElementById("deleteUserButton").onclick = async function (evt) {

        try {
      
        let confirmation = prompt('Confirm action by typing: "DELETE USER"');
        console.log(confirmation);

        if (confirmation === "DELETE USER") {
          
          let body = {
                username: userData.username,
                userid: userData.userid
            }
            let config = {
                method: "POST",
                headers: {
                    "content-type": "application/json",
                    "authorization": credentials
                },
                body: JSON.stringify(body)
            }
            console.log(config);

            fetch("/deleteUser", config).then(resp => {
                console.log(resp.status);
            })
            sessionStorage.removeItem("userData");
            sessionStorage.removeItem("listData");
            sessionStorage.removeItem("itemData");
            location.href="index.html"
        }

        } catch (error) {
            console.error(error)
        }
      }
        
            
        
    

</script>

</html>